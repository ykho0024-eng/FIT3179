<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Australia Personal Safety Maps</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .viz-container {
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
        }
    </style>
</head>
<body>

<h1>Personal Safety in Australia</h1>

<div class="pure-g">
    <!-- Left column: 2024 map -->
    <div class="pure-u-1-2">
        <h2>2024 Victims per 10,000</h2>
        <div id="map2024" class="viz-container"></div>
    </div>

    <!-- Right column: 1993–2024 map -->
    <div class="pure-u-1-2">
        <h2>Victims per 10,000 (1993–2024)</h2>
        <div id="mapAllYears" class="viz-container"></div>
    </div>
</div>

<script>
    // 2024 Map Spec
    const map2024Spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 400,
        "height": 400,
        "title": "Personal Safety in Australia (2024)",
        "projection": {"type": "equalEarth"},
        "layer": [
            {
                "data": {
                    "url": "https://raw.githubusercontent.com/ykho0024-eng/FIT3179/refs/heads/main/week9hw/ne_1.json",
                    "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
                },
                "mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"}
            },
            {
                "data": {
                    "url": "https://raw.githubusercontent.com/ykho0024-eng/FIT3179/refs/heads/main/week9hw/fit3179_week_9_final.csv",
                    "format": {"type": "csv"}
                },
                "transform": [
                    {"filter": "datum.YEAR == '2024'"},
                    {
                        "lookup": "state",
                        "from": {
                            "data": {
                                "url": "https://raw.githubusercontent.com/ykho0024-eng/FIT3179/refs/heads/main/week9hw/ne_1.json",
                                "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
                            },
                            "key": "properties.name",
                            "fields": ["properties", "geometry"]
                        },
                        "as": ["geo_properties", "geo_geometry"]
                    },
                    {
                        "calculate": "toNumber(datum.total)/toNumber(datum.population)*10000",
                        "as": "Victims_per_10000"
                    }
                ],
                "mark": {"type": "geoshape"},
                "encoding": {
                    "shape": {"field": "geo_geometry", "type": "geojson"},
                    "color": {
                        "field": "Victims_per_10000",
                        "type": "quantitative",
                        "scale": {
                            "type": "threshold",
                            "domain": [100,200,300,400,500,600,700,800,900],
                            "range": [
                                "#ffe5e5","#fcbaba","#f28c8c","#e85c5c",
                                "#d92e2e","#b81d1d","#7a0c0c","#3d0505",
                                "#280303","#1a0000"
                            ]
                        },
                        "legend": {"title": "Victims per 10,000"}
                    },
                    "tooltip": [
                        {"field": "state", "title": "State/Territory"},
                        {"field": "total", "title": "Victims Count"},
                        {"field": "Victims_per_10000", "type": "quantitative", "format": ".2f"}
                    ]
                }
            }
        ]
    };

    // 1993–2024 Map Spec
    const mapAllYearsSpec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 400,
        "height": 400,
        "title": "Personal Safety in Australia (1993–2024)",
        "projection": {"type": "mercator","center":[134,-25],"scale":750},
        "params": [
            {
                "name": "year_selection",
                "value": 2024,
                "bind": {
                    "input": "select",
                    "options": Array.from({length: 32}, (_,i)=>1993+i),
                    "name": "Select Year: "
                }
            }
        ],
        "layer": [
            {
                "data": {
                    "url": "https://raw.githubusercontent.com/ykho0024-eng/FIT3179/refs/heads/main/week10hw/final_ne_1.json",
                    "format": {"type":"topojson","feature":"ne_10m_admin_1_states_provinces"}
                },
                "mark": {"type":"geoshape","fill":"lightgray","stroke":"white"}
            },
            {
                "data":{"graticule":{"step":[10,10]}},
                "mark":{"type":"geoshape","stroke":"lightgrey","strokeWidth":1}
            },
            {
                "data":{
                    "url":"https://raw.githubusercontent.com/ykho0024-eng/FIT3179/refs/heads/main/week10hw/fit3179%20week%2010%20hw.csv",
                    "format":{"type":"csv"}
                },
                "transform":[
                    {"filter":"toNumber(datum.YEAR)==year_selection"},
                    {
                        "lookup":"state",
                        "from":{
                            "data":{
                                "url":"https://raw.githubusercontent.com/ykho0024-eng/FIT3179/refs/heads/main/week10hw/final_ne_1.json",
                                "format":{"type":"topojson","feature":"ne_10m_admin_1_states_provinces"}
                            },
                            "key":"properties.name",
                            "fields":["properties","geometry"]
                        },
                        "as":["geo_properties","geo_geometry"]
                    },
                    {
                        "calculate":"toNumber(datum.total)/toNumber(datum.population)*10000",
                        "as":"Victims_per_10000"
                    }
                ],
                "mark":{"type":"geoshape"},
                "encoding":{
                    "shape":{"field":"geo_geometry","type":"geojson"},
                    "color":{
                        "field":"Victims_per_10000",
                        "type":"quantitative",
                        "scale":{
                            "type":"threshold",
                            "domain":[100,200,300,400,500,600,700,800,900],
                            "range":["#ffe5e5","#fcbaba","#f28c8c","#e85c5c","#d92e2e","#b81d1d","#7a0c0c","#3d0505","#280303","#1a0000"]
                        },
                        "legend":{"title":"Victims per 10,000"}
                    },
                    "tooltip":[
                        {"field":"state","title":"State/Territory"},
                        {"field":"YEAR","title":"Year"},
                        {"field":"total","title":"Victims Count"},
                        {"field":"Victims_per_10000","type":"quantitative","format":".2f"}
                    ]
                }
            }
        ]
    };

    // Embed both maps
    vegaEmbed('#map2024', map2024Spec, {actions:false});
    vegaEmbed('#mapAllYears', mapAllYearsSpec, {actions:false});
</script>

</body>
</html>
